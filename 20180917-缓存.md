每次遇到 bug 时，就去看自己的代码有没有错，逻辑有没有错，咦，感觉都没什么问题呀！那为什么上线后就没有反应呢！！！

哼，大概就是 **缓存** 的锅吧！

## HTTP缓存机制

![缓存机制](http://pc27eqqvo.bkt.clouddn.com/%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6.png)

* 强缓存：用户发送的请求，直接从客户端缓存中获取，不发送请求到服务器，不与服务器发生交互行为。

* 协商缓存：用户发送的请求，发送到服务器后，由服务器判定是否从缓存中获取资源。

共同点：客户端获得的数据最后都是从客户端缓存中获得。

区别：从名字可以看出，强缓存不与服务器交互，而协商缓存需要与服务器交互。

当用户通过浏览器发起一个数据请求时，浏览器会通过以下几个步骤来获取数据：

1. **本地缓存阶段：** 先在本地查找该数据，如果有发现该数据，而且该数据没有过期，就使用该数据，不会发送 http 请求到服务器
2. **协商缓存阶段：** 如果在本地缓存找到对应的数据，但是不知道该数据是否过期，则发一个 http 请求到服务器，然后服务器判断这个请求，如果请求的数据在服务器上没有改动过或过期，则返回 304 状态，让浏览器在本地找到该数据
3. **缓存失败阶段：** 当服务器发现请求的资源已经修改过，或者这是一个新的请求，服务器则返回该数据，并且返回 200 状态码，此过程的前提是指找到该数据，如果服务器上没有数据，则返回 404

## 浏览器中的操作对缓存的影响

* **强制刷新：** 按 ctrl+F5 刷新页面，浏览器将绕过各种缓存（本地缓存和协商缓存），直接让服务器返回最新数据
* **普通刷新：** 按 F5 或者点击刷新按钮来刷新页面时，浏览器将绕过本地缓存请求给服务器，此时协商缓存是有效的
* **回车或跳转：** 当在地址栏上输入回车或者按下跳转按钮时，所有缓存都生效